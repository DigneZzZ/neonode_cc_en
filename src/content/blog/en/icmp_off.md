---
title: Отключение двухстороннего пинга
description: Хотите замаскировать свой VPN или proxy? Узнайте, как отключить двусторонний пинг для повышения анонимности.
tags:
  - icmp
  - ping
  - linux
  - двухсторонний пинг
  - ICMP ping
series: server
draft: false
pubDate: 09 10 2024
---

# Отключение двухстороннего пинга

**Вы стремитесь максимально замаскировать свой VPN или proxy?** Тогда вам наверняка необходимо отключить двусторонний пинг, чтобы скрыть туннель и предотвратить его определение. 

В этой краткой, но полезной заметке, я расскажу, как отключить ответ на ICMP пинг на Linux и Windows.

---

## Что такое двухсторонний пинг?

Двусторонний пинг позволяет определить, что сервер находится в сети, отправляя ICMP-запросы и получая ответы. Отключив ответы на ICMP, вы можете скрыть туннель и сделать ваш VPN или proxy менее заметным.

---

## Шаги для отключения двухстороннего пинга на Linux

### 1. Подключение к серверу

Подключитесь к вашему серверу через `ssh` и войдите под пользователем `root`:

```bash
ssh root@your-server-ip
```

### 2. Редактирование настроек фаервола UFW

Для начала нужно отредактировать правила фаервола **ufw**. Откройте файл конфигурации `before.rules` с помощью редактора **nano**:

```bash
nano /etc/ufw/before.rules
```

### 3. Добавление правил блокировки ICMP

Добавьте следующие строки в файл, чтобы блокировать различные типы ICMP-запросов:

```bash
# Disable ICMP ping responses
-A ufw-before-input -p icmp --icmp-type destination-unreachable -j DROP
-A ufw-before-input -p icmp --icmp-type source-quench -j DROP
-A ufw-before-input -p icmp --icmp-type time-exceeded -j DROP
-A ufw-before-input -p icmp --icmp-type parameter-problem -j DROP
-A ufw-before-input -p icmp --icmp-type echo-request -j DROP
```

Эти правила отключат различные типы ICMP-запросов, включая `echo-request`, который используется для стандартных ping-запросов.

### 4. Перезапуск UFW

После внесения изменений перезапустите фаервол UFW, чтобы правила вступили в силу:

```bash
ufw disable && ufw enable
```

### 5. Проверка

Теперь ваш сервер не должен отправлять ICMP-ответы, что делает его менее заметным для тех, кто пытается "пропинговать" ваш туннель.

Можно зайти на сайт [2ip.io](https://2ip.io/privacy/) и проверить уровень анонимности.

---

## Важные замечания

- **Ограничения**: Отключение ICMP-пинга может затруднить диагностику проблем с сетью, так как ping-запросы используются для проверки доступности сервера.
- **Альтернатива**: Если полное отключение ICMP не подходит, можно рассмотреть частичное ограничение, блокируя только определённые типы ICMP-запросов.

---

## Заключение

Отключение двустороннего пинга — это простой и эффективный способ повысить анонимность вашего сервера, туннеля VPN или proxy. Однако будьте внимательны при изменении настроек сети, так как это может повлиять на доступность сервера для мониторинга и диагностики. 

Если вы стремитесь к максимальной маскировке своего трафика, этот метод поможет вам добиться большей приватности.

Вот более подробное обновление к статье, с объяснением и инструкциями по разрешению ICMP echo-request только для конкретного IP-адреса, и дополнительные рекомендации для работы с Uptime Kuma:

---

## Обновление: Разрешение ICMP echo-request для конкретного IP

Недавно ко мне обратились с ситуацией, когда на сервере, где пинг был отключен для повышения анонимности, также работал мониторинг через Uptime Kuma. Конечно, для мониторинга нужен доступ через ICMP, но разрешить пинг для всех было не лучшим вариантом. Вот как я решил проблему, разрешив ICMP echo-request только для конкретного IP.

### 1. Разрешение ICMP echo-request от IP Uptime Kuma

Сначала я открыл доступ для ICMP-запросов от определённого IP-адреса, с которого приходит мониторинг. Например, если IP Uptime Kuma – `1.2.3.4`:

```bash
sudo iptables -A INPUT -p icmp --icmp-type echo-request -s 1.2.3.4 -j ACCEPT
```

### 2. Блокировка всех остальных ICMP-запросов

Для защиты сервера я также заблокировал все остальные ICMP-запросы от других IP:

```bash
sudo iptables -A INPUT -p icmp --icmp-type echo-request -j DROP
```

### 3. Дополнительные ICMP для мониторинга

Некоторые системы мониторинга, такие как Uptime Kuma, могут использовать другие типы ICMP-запросов для диагностики, поэтому я разрешил еще пару важных типов запросов:

```bash
# Разрешить Destination Unreachable от конкретного IP
sudo iptables -A INPUT -p icmp --icmp-type destination-unreachable -s 1.2.3.4 -j ACCEPT

# Разрешить Time Exceeded от конкретного IP
sudo iptables -A INPUT -p icmp --icmp-type time-exceeded -s 1.2.3.4 -j ACCEPT
```

Это помогло сохранить функциональность мониторинга, не открывая ICMP для всего интернета.

### 4. Сохранение настроек iptables

После настройки я сохранил правила iptables, чтобы они применялись после перезагрузки:

```bash
sudo iptables-save | sudo tee /etc/iptables/rules.v4
```

Теперь мониторинг от Uptime Kuma работает, а сервер остается защищённым от нежелательных ICMP-запросов.